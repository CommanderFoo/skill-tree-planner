<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A powerful skill tree planner and editor for designing game skill systems">
    <title>Skill Tree Planner</title>
    <link rel="stylesheet" href="src/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header Toolbar -->
        <header id="toolbar" class="toolbar">
            <div class="toolbar_left">
                <h1 class="app_title">Skill Tree Planner</h1>
                <div class="tree_selector">
                    <select id="tree_select" class="tree_select">
                        <option value="">No tree selected</option>
                    </select>
                    <button id="btn_add_tree" class="btn btn_icon" title="Add new tree">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="toolbar_center">
                <div class="point_display">
                    <span class="point_label">Points:</span>
                    <span id="points_available" class="points_value">0</span>
                    <span class="point_separator">/</span>
                    <span id="points_total" class="points_value">0</span>
                </div>
            </div>
            <div class="toolbar_right">
                <div class="mode_toggle">
                    <button id="btn_mode_edit" class="btn btn_mode active" data-mode="edit">Edit</button>
                    <button id="btn_mode_play" class="btn btn_mode" data-mode="play">Play</button>
                </div>
                <div class="zoom_controls">
                    <button id="btn_zoom_out" class="btn btn_icon" title="Zoom out (scroll down)">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M19 13H5v-2h14v2z" />
                        </svg>
                    </button>
                    <span id="zoom_level" class="zoom_level"
                        title="Current zoom level. Scroll to zoom, hold Space+drag to pan.">100%</span>
                    <button id="btn_zoom_in" class="btn btn_icon" title="Zoom in (scroll up)">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </button>
                    <button id="btn_reset_view" class="btn btn_icon"
                        title="Reset view to default (100% zoom, centered)">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor"
                                d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" />
                        </svg>
                    </button>
                    <button id="btn_zoom_fit" class="btn btn_icon" title="Zoom to Fit (F)">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor"
                                d="M15 3l2.3 2.3-2.89 2.87 1.42 1.42L18.7 6.7 21 9V3zM3 9l2.3-2.3 2.87 2.89 1.42-1.42L6.7 5.3 9 3H3zm6 12l-2.3-2.3 2.89-2.87-1.42-1.42L5.3 17.3 3 15v6zm12-6l-2.3 2.3-2.87-2.89-1.42 1.42 2.89 2.87L15 21h6z" />
                        </svg>
                    </button>
                </div>
                <div class="toolbar_actions">
                    <button id="btn_reset" class="btn btn_secondary" title="Reset all points">
                        Reset
                    </button>
                    <button id="btn_export" class="btn btn_secondary" title="Export project">
                        Export
                    </button>
                    <button id="btn_import" class="btn btn_secondary" title="Import project">
                        Import
                    </button>
                </div>
            </div>
        </header>
        <!-- Main Content Area -->
        <main id="main_content" class="main_content">
            <!-- Canvas Area -->
            <div id="canvas_container" class="canvas_container">
                <svg id="connections_layer" class="connections_layer"></svg>
                <svg id="temp_connection_layer" class="temp_connection_layer"></svg>
                <div id="nodes_layer" class="nodes_layer"></div>
                <!-- Empty State -->
                <div id="empty_state" class="empty_state">
                    <div class="empty_state_content">
                        <svg viewBox="0 0 24 24" width="64" height="64" class="empty_state_icon">
                            <path fill="currentColor"
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                        </svg>
                        <h2>No Skill Tree</h2>
                        <p>Create your first skill tree to get started</p>
                        <button id="btn_create_first_tree" class="btn btn_primary">
                            Create Skill Tree
                        </button>
                    </div>
                </div>
            </div>
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar">
                <div class="sidebar_header">
                    <h2 class="sidebar_title">Properties</h2>
                    <button id="btn_toggle_sidebar" class="btn btn_icon" title="Toggle sidebar">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z" />
                        </svg>
                    </button>
                </div>
                <!-- Tree Properties Panel -->
                <section id="tree_properties" class="sidebar_panel">
                    <h3 class="panel_title">Tree Settings</h3>
                    <div class="form_group">
                        <label for="tree_name">Name</label>
                        <input type="text" id="tree_name" class="input" placeholder="Tree name"
                            title="Display name for this skill tree. Used in the dropdown selector and export filename.">
                    </div>
                    <div class="form_group">
                        <label for="tree_description">Description</label>
                        <textarea id="tree_description" class="input textarea" placeholder="Tree description"
                            title="Optional description explaining the purpose or theme of this skill tree."></textarea>
                    </div>
                    <div class="form_group">
                        <label for="tree_points">Total Points</label>
                        <input type="number" id="tree_points" class="input" min="0" value="20"
                            title="Maximum number of points available to allocate in this tree. Players can spend these points on skills during Play mode.">
                    </div>
                    <div class="form_group">
                        <label for="export_convention">Export Naming</label>
                        <select id="export_convention" class="input"
                            title="Naming convention for JSON export keys (e.g., for Unity/C# compatibility).">
                            <option value="snake_case">snake_case (Default)</option>
                            <option value="camelCase">camelCase</option>
                            <option value="PascalCase">PascalCase</option>
                        </select>
                    </div>
                    <div class="form_actions">
                        <button id="btn_delete_tree" class="btn btn_danger"
                            title="Permanently delete this skill tree and all its nodes. This action cannot be undone.">Delete
                            Tree</button>
                    </div>

                    <div id="tree_warnings" class="validation_warnings hidden">
                        <h4 class="warning_title">⚠️ Warnings</h4>
                        <ul id="warning_list" class="warning_list"></ul>
                    </div>
                </section>
                <!-- Node Properties Panel -->
                <section id="node_properties" class="sidebar_panel hidden">
                    <h3 class="panel_title">Node Settings</h3>
                    <div class="form_group">
                        <label for="node_name">Name</label>
                        <input type="text" id="node_name" class="input" placeholder="Skill name"
                            title="Display name for this skill node. Shown on the node and in tooltips.">
                    </div>
                    <div class="form_group">
                        <label for="node_description">Description</label>
                        <textarea id="node_description" class="input textarea" placeholder="Skill description"
                            title="Detailed description of what this skill does. Displayed in the hover tooltip."></textarea>
                    </div>
                    <div class="form_row">
                        <div class="form_group">
                            <label for="node_max_rank">Max Rank</label>
                            <input type="number" id="node_max_rank" class="input" min="1" value="1"
                                title="Maximum number of points that can be invested in this skill. Higher ranks usually provide stronger effects.">
                        </div>
                        <div class="form_group">
                            <label for="node_type">Type</label>
                            <select id="node_type" class="input"
                                title="Passive skills provide constant bonuses. Active skills typically grant usable abilities.">
                                <option value="passive">Passive</option>
                                <option value="active">Active</option>
                            </select>
                        </div>
                    </div>
                    <div class="form_group">
                        <label for="node_costs">Cost per Rank</label>
                        <input type="text" id="node_costs" class="input" placeholder="1, 1, 2, 3"
                            title="Point cost for each rank. Use comma-separated values for different costs per rank (e.g., '1, 2, 3' means rank 1 costs 1 point, rank 2 costs 2 points, etc.).">
                        <span class="form_hint">Comma-separated list</span>
                    </div>
                    <div class="form_group">
                        <label for="node_event">Event String</label>
                        <input type="text" id="node_event" class="input" placeholder="OnSkillUnlocked"
                            title="A unique event identifier when this node is interacted with.">
                    </div>
                    <div class="form_row">
                        <div class="form_group">
                            <label for="node_prereq_logic">Prerequisite Logic</label>
                            <select id="node_prereq_logic" class="input"
                                title="Define how this node evaluates its prerequisites. AND: All prerequisites required. OR: Any one prerequisite required. SUM: Total points in prerequisites must meet threshold.">
                                <option value="AND">AND (All)</option>
                                <option value="OR">OR (Any)</option>
                                <option value="SUM">SUM (Total)</option>
                            </select>
                        </div>
                        <div id="group_node_threshold" class="form_group hidden">
                            <label for="node_prereq_threshold">Required Total</label>
                            <input type="number" id="node_prereq_threshold" class="input" min="1" value="1"
                                title="Threshold for SUM logic: total points spent in ALL parent nodes must reach this value.">
                        </div>
                    </div>

                    <div class="form_actions">
                        <button id="btn_delete_node" class="btn btn_danger"
                            title="Permanently delete this skill node and any connections to it. This action cannot be undone.">Delete
                            Node</button>
                    </div>
                </section>
                <!-- Connection Mode Panel -->
                <section id="connection_panel" class="sidebar_panel hidden">
                    <h3 class="panel_title">Create Connection</h3>
                    <p class="panel_description">
                        Click a source node, then click a target node to create a dependency.
                    </p>
                    <div class="form_group">
                        <label for="connection_rank">Required Rank</label>
                        <input type="number" id="connection_rank" class="input" min="1" value="1"
                            title="Minimum rank the source node must reach before the target node becomes unlockable. For example, '2' means the prerequisite skill needs at least 2 points invested.">
                    </div>
                    <div class="form_actions">
                        <button id="btn_cancel_connection" class="btn btn_secondary"
                            title="Exit connection creation mode without creating a connection.">Cancel</button>
                    </div>
                </section>
                <!-- Edit Mode Tools -->
                <section id="edit_tools" class="sidebar_panel">
                    <h3 class="panel_title">Tools</h3>
                    <div class="tool_buttons">
                        <button id="btn_add_node" class="btn btn_tool"
                            title="Create a new skill node on the canvas. Drag nodes to reposition them, click to select and edit properties.">
                            <svg viewBox="0 0 24 24" width="20" height="20">
                                <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            Add Node
                        </button>
                        <button id="btn_connect_mode" class="btn btn_tool"
                            title="Create dependencies between nodes. Click a prerequisite node first, then click the dependent node to connect them.">
                            <svg viewBox="0 0 24 24" width="20" height="20">
                                <path fill="currentColor"
                                    d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                            </svg>
                            Connect Nodes
                        </button>
                    </div>
                    <p class="panel_hint">
                        <strong>Tip:</strong> Shift+drag from a node to quickly connect it. Click a connection line to
                        delete it. Use <strong>A</strong> to add a node at center, <strong>D</strong> to delete hovered
                        skill.
                    </p>
                </section>
            </aside>
            <!-- Floating sidebar toggle (visible when sidebar collapsed) -->
            <button id="btn_show_sidebar" class="btn_show_sidebar" title="Show properties panel">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                </svg>
            </button>
        </main>
        <!-- Tooltip -->
        <div id="tooltip" class="tooltip hidden">
            <div class="tooltip_header">
                <span id="tooltip_name" class="tooltip_name"></span>
                <span id="tooltip_rank" class="tooltip_rank"></span>
            </div>
            <p id="tooltip_description" class="tooltip_description"></p>
            <div id="tooltip_cost" class="tooltip_cost"></div>
            <div id="tooltip_status" class="tooltip_status"></div>
        </div>
        <!-- Import Modal -->
        <div id="import_modal" class="modal hidden">
            <div class="modal_backdrop"></div>
            <div class="modal_content">
                <div class="modal_header">
                    <h2>Import Project</h2>
                    <button id="btn_close_import" class="btn btn_icon">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor"
                                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                        </svg>
                    </button>
                </div>
                <div class="modal_body">
                    <p>Paste your project JSON below or drag and drop a .json file:</p>
                    <textarea id="import_json" class="input textarea_large"
                        placeholder='{"version": "1.0.0", "project": {...}}'></textarea>
                    <div id="import_dropzone" class="dropzone">
                        <p>Drop JSON file here</p>
                    </div>
                </div>
                <div class="modal_footer">
                    <button id="btn_cancel_import" class="btn btn_secondary">Cancel</button>
                    <button id="btn_confirm_import" class="btn btn_primary">Import</button>
                </div>
            </div>
        </div>
        <!-- Tree Name Modal -->
        <div id="tree_modal" class="modal hidden">
            <div class="modal_backdrop"></div>
            <div class="modal_content modal_small">
                <div class="modal_header">
                    <h2>New Skill Tree</h2>
                </div>
                <div class="modal_body">
                    <div class="form_group">
                        <label for="new_tree_name">Tree Name</label>
                        <input type="text" id="new_tree_name" class="input" placeholder="Enter tree name">
                    </div>
                </div>
                <div class="modal_footer">
                    <button id="btn_cancel_tree" class="btn btn_secondary">Cancel</button>
                    <button id="btn_confirm_tree" class="btn btn_primary">Create</button>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="src/main.js"></script>
</body>
</html>